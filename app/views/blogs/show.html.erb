<div class="page-content">
  <%= link_to "Go to the #{@subblog.name} subblog", subblog_path(@subblog), class: "btn btn-primary make-it-green" %>
  <br/><br/>

  <h5><%= "Moderator: #{@subblog.user.username}" %></h5>
  <h1><%= @blog.title %></h1>

  <div class="user-profile-link">
    <%= "#{@blog.time_since_post} by " %>
    <%= link_to "#{@blog.user.username}", user_path(@blog.user), class: "make-it-green" %>
    <% if @blog.user == @subblog.user %>
      <%= link_to "[M]", '#', class: "make-it-blue" %>
    <% end %>
    <% if current_user == @blog.user %>
      <%= link_to "edit this post", edit_subblog_blog_path(@subblog, @blog), class: " btn btn-primary make-it-green" %>
      <%= 
        link_to "Delete this blog post",
        subblog_blog_path(@subblog, @blog),
        method: :delete, data: { confirm: "Are you sure that you want to delete this blog post?" },
        class: "btn btn-primary make-it-green" 
      %>
    <% end %>
  </div>

  <div class="box col-7 blog-content move-it-down-just-a-bit">
    <%= @blog.content %>
  </div>

  <% if current_user %>
    <div class="col-7 comment-form">
      <br/>
      <%= simple_form_for @comment, url: subblog_blog_comments_path(@subblog, @blog) do |f|%>
        <%= f.input :message, label: "Total comments: #{@blog.comments.count}", placeholder: "Add a comment" %>
        <%= f.submit 'Post Comment', class: 'btn btn-primary make-it-green' %>
      <% end %>
    </div>
    <br/>
  <% else %>
    <br/>
    <h3>Login to post comments</h3>
    <br/>
  <% end %>

  <% @blog.comments.each do |comment| %>
    <div class="comment-info">
      <%= link_to "#{comment.user.username}", user_path(comment.user), class: "make-it-green" %>
      <% if comment.user == @subblog.user %>
        <%= link_to "[M]", '#', class: "make-it-blue" %>
      <% end %>
      <%= "#{comment.time_since_post}" %>
      <% if comment.user == @blog.user %>
        <%= " by the blog author" %>
      <% end %>
      <br/>
    </div>
    <div class="comment col-7">
      <%= comment.message %>
    </div>
    <% if current_user == comment.user %>
      <div class="comment-actions">
        <%=
          link_to "delete",
          subblog_blog_comment_path(@subblog, @blog, comment),
          method: :delete, data: { confirm: "Are you sure that you want to delete this comment?" },
          class: "make-it-green"
        %>
        <%= " | " %>
        <%= link_to "edit", edit_subblog_blog_comment_path(@subblog, @blog, comment), class: "make-it-green" %>
        <%= " | " %>
        <%= link_to "reply", new_subblog_blog_comment_response_path(@subblog, @blog, comment), class: "make-it-green" %>
        <%= react_component("Responses", { subblog_id: @subblog.id, blog_id: @blog.id, comment_id: comment.id, username: current_user.username, user_id: current_user.id, moderator_username: @subblog.user.username }) %>
      </div>
    <% elsif current_user %>
      <%= link_to "reply", new_subblog_blog_comment_response_path(@subblog, @blog, comment), class: "make-it-green" %>
      <%= react_component("Responses", { subblog_id: @subblog.id, blog_id: @blog.id, comment_id: comment.id, username: current_user.username, user_id: current_user.id, moderator_username: @subblog.user.username }) %>
    <% else %>
      <%= react_component("Responses", { subblog_id: @subblog.id, blog_id: @blog.id, comment_id: comment.id, moderator_username: @subblog.user.username }) %>
    <% end %>
    <br/><br/>
  <% end %>

</div>
